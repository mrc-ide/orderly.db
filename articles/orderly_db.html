<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction • orderly.db</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction">
<meta property="og:description" content="orderly.db">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">orderly.db</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/orderly_db.html">Introduction</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/vimc/orderly.db/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/vimc/orderly.db/blob/HEAD/vignettes/orderly_db.Rmd" class="external-link"><code>vignettes/orderly_db.Rmd</code></a></small>
      <div class="hidden name"><code>orderly_db.Rmd</code></div>

    </div>

    
    
<p>The <code>orderly.db</code> package is an <code>orderly2</code>
plugin which provides support for interacting with databases. It
includes all core features that <code>orderly</code> (version 1)
supported, but with the new syntax.</p>
<p>This documentation is based off the original orderly vignette. There
is a section at the end of the vignette with some comparisons of old and
new syntaxes.</p>
<div class="section level2">
<h2 id="configuration">Configuration<a class="anchor" aria-label="anchor" href="#configuration"></a>
</h2>
<p>The root <code>orderly_config.yml</code> configuration specifies the
locations of databases (there can be any number), within the plugins
section. For example,</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plugins</span><span class="kw">:</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">orderly.db</span><span class="kw">:</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">source</span><span class="kw">:</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">driver</span><span class="kw">:</span><span class="at"> RPostgres::Postgres</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">args</span><span class="kw">:</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">host</span><span class="kw">:</span><span class="at"> dbhost.example.org</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">port</span><span class="kw">:</span><span class="at"> </span><span class="dv">5432</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">user</span><span class="kw">:</span><span class="at"> myusername</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">password</span><span class="kw">:</span><span class="at"> s3cret</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">dbname</span><span class="kw">:</span><span class="at"> mydb</span></span></code></pre></div>
<p>This database will be referred to elsewhere as <code>source</code>
and it will be connected with the <code>RPostgres::Postgres</code>
driver (from the <a href="https://cran.r-project.org/package=RPostgres" class="external-link">RPostgres</a>
package). Arguments within the <code>args</code> block will be passed to
the driver, in this case being the equivalent of:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">RPostgres</span><span class="fu">::</span><span class="va">Postgres</span>, host <span class="op">=</span> <span class="st">"dbhost.example.org"</span>, port <span class="op">=</span> <span class="fl">5432</span>,</span>
<span>               user <span class="op">=</span> <span class="st">"myusername"</span>, password <span class="op">=</span> <span class="st">"s3cret"</span>, dbname <span class="op">=</span> <span class="st">"mydb"</span><span class="op">)</span></span></code></pre></div>
<p>The values used in the <code>args</code> blocks can be environment
values (e.g., <code>password: $DB_PASSWORD</code>) in which case they
will be resolved from the environment before connecting (including from
<code>orderly_envir.yml</code>). This will be useful for keeping secrets
out of source control.</p>
<p>For <a href="https://cran.r-project.org/package=RSQLite" class="external-link">SQLite</a>
databases, the <code>args</code> block will typically contain only
<code>dbname</code> which is the path to the database file.</p>
</div>
<div class="section level2">
<h2 id="use-within-a-report">Use within a report<a class="anchor" aria-label="anchor" href="#use-within-a-report"></a>
</h2>
<p>Within a report’s <code>orderly.R</code> file, you can extract data
from the database as:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly.db</span><span class="fu">::</span><span class="fu">orderly_db_data</span><span class="op">(</span>as <span class="op">=</span> <span class="st">"cars"</span>, database <span class="op">=</span> <span class="st">"source"</span>,</span>
<span>                             query <span class="op">=</span> <span class="st">"SELECT * FROM mtcars WHERE cyl = 4"</span><span class="op">)</span></span></code></pre></div>
<p>In this case, the query
<code>SELECT * FROM mtcars WHERE cyl = 4</code> will be run against the
<code>source</code> database to create an object <code>cars</code> in
the report environment. The actual report code can use that object
without having ever created the database connection or evaluating the
query.</p>
<p>You can interpolate parameters into the query; for example you might
have:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly2</span><span class="fu">::</span><span class="fu">orderly_parameter</span><span class="op">(</span>cyl <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="fu">orderly.db</span><span class="fu">::</span><span class="fu">orderly_db_data</span><span class="op">(</span>as <span class="op">=</span> <span class="st">"cars"</span>, database <span class="op">=</span> <span class="st">"source"</span>,</span>
<span>                             query <span class="op">=</span> <span class="st">"SELECT * FROM mtcars WHERE cyl = ?cyl"</span><span class="op">)</span></span></code></pre></div>
<p>In the above, we declare an orderly parameter <code>cyl</code> with
no default (see <code>?orderly2::orderly_parameter</code>) and use
<code>?cyl</code> to interpolate that into the query (see
<code><a href="https://dbi.r-dbi.org/reference/sqlInterpolate.html" class="external-link">?DBI::sqlInterpolate</a></code> which does the interpolation for us).
You can only use orderly varibles for this; if you need more complex
substitution you can create strings using <code>paste</code> or
<code>sprintf</code> as suits your needs.</p>
<p>You can establish temporary views in the database in order to
simplify queries. For example, you might write:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly.db</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_db_view.html">orderly_db_view</a></span><span class="op">(</span>as <span class="op">=</span> <span class="st">"cars4"</span>, database <span class="op">=</span> <span class="st">"source"</span>,</span>
<span>                             query <span class="op">=</span> <span class="st">"SELECT * FROM mtcars WHERE cyl = 4"</span><span class="op">)</span></span>
<span><span class="fu">orderly.db</span><span class="fu">::</span><span class="fu">orderly_db_data</span><span class="op">(</span>as <span class="op">=</span> <span class="st">"cars"</span>, database <span class="op">=</span> <span class="st">"source"</span>,</span>
<span>                             query <span class="op">=</span> <span class="st">"SELECT * FROM cars4"</span><span class="op">)</span></span></code></pre></div>
<p>Here, we establish a view called <code>cars4</code> within the
database; this is scoped to the current connection
(<code>orderly.db</code> ensures that the same connection is used for
all calls to the database within a report run). Then we query against
that view to pull the data down as the <code>cars</code> R object. In a
real case this view could be more complicated, involving joins with
other tables.</p>
<p>If you need to perform complicated SQL queries, then you can export
the database connection directly by writing</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly.db</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_db_connection.html">orderly_db_connection</a></span><span class="op">(</span>as <span class="op">=</span> <span class="st">"con"</span>, database <span class="op">=</span> <span class="st">"source"</span><span class="op">)</span></span></code></pre></div>
<p>which will save the connection to the <code>source</code> database as
the R object <code>con</code>. We have used this where a report requires
running queries in a loop that depend on the results of a previous query
or additional data loaded into a report. Note that this reduces the
amount of tracking that <code>orderly</code> can do, as we have no way
of knowing what is done with the connection once passed to the
script.</p>
</div>
<div class="section level2">
<h2 id="more-on-configuration">More on configuration<a class="anchor" aria-label="anchor" href="#more-on-configuration"></a>
</h2>
<div class="section level3">
<h3 id="environment-variables-for-passwords">Environment variables for passwords<a class="anchor" aria-label="anchor" href="#environment-variables-for-passwords"></a>
</h3>
<p>The contents of <code>orderly_config.yml</code> may contain things
like secrets (passwords) or hostnames that vary depending on deployment
(e.g., testing locally vs running on a remote system). To customise
this, you can use environment variables within the configuration. So
rather than writing</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plugins</span><span class="kw">:</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">orderly.db</span><span class="kw">:</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">source</span><span class="kw">:</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">driver</span><span class="kw">:</span><span class="at"> RPostgres::Postgres</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">args</span><span class="kw">:</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">host</span><span class="kw">:</span><span class="at"> localhost</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">port</span><span class="kw">:</span><span class="at"> </span><span class="dv">5432</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">user</span><span class="kw">:</span><span class="at"> myuser</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">dbname</span><span class="kw">:</span><span class="at"> databasename</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">password</span><span class="kw">:</span><span class="at"> p4ssw0rd</span></span></code></pre></div>
<p>you might write</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plugins</span><span class="kw">:</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">orderly.db</span><span class="kw">:</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">source</span><span class="kw">:</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">driver</span><span class="kw">:</span><span class="at"> RPostgres::Postgres</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">args</span><span class="kw">:</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">host</span><span class="kw">:</span><span class="at"> $MY_DBHOST</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">port</span><span class="kw">:</span><span class="at"> $MY_DBPORT</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">user</span><span class="kw">:</span><span class="at"> $MY_DBUSER</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">dbname</span><span class="kw">:</span><span class="at"> $MY_DBNAME</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">password</span><span class="kw">:</span><span class="at"> $MY_PASSWORD</span></span></code></pre></div>
<p>environment variables, as used this way <strong>must</strong> begin
with a dollar sign and consist only of uppercase letters, numbers and
the underscore character. You can then set the environment variables in
an <code>.Renviron</code> (either within the project or in your home
directory) file or your <code>.profile</code> file. Alternatively, you
can create a file <code>orderly_envir.yml</code> in the same directory
as <code>orderly_config.yml</code> with key-value pairs, such as</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">MY_DBHOST</span><span class="kw">:</span><span class="at"> localhost</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">MY_DBPORT</span><span class="kw">:</span><span class="at"> </span><span class="dv">5432</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">MY_DBUSER</span><span class="kw">:</span><span class="at"> myuser</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">MY_DBNAME</span><span class="kw">:</span><span class="at"> databasename</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">MY_PASSWORD</span><span class="kw">:</span><span class="at"> p4ssw0rd</span></span></code></pre></div>
<p>This is read every time that <code>orderly_config.yml</code> is read
(in contrast with <code>.Renviron</code> which is read-only at the start
of a session). This will likely be more pleasant to work with.</p>
<p>The advantage of using environment variables is that you can add the
<code>orderly_envir.yml</code> file to your <code>.gitignore</code> and
avoid committing system-dependent data to the central repository.</p>
</div>
<div class="section level3">
<h3 id="advanced-database-configuration">Advanced database configuration<a class="anchor" aria-label="anchor" href="#advanced-database-configuration"></a>
</h3>
<p><em>In general, you can ignore this section if you only use one
global database.</em></p>
<p>The above approach can be used to switch databases by using different
environmental variables, but that can become tiresome. If you have
multiple database “instances” corresponding to different realisations of
the same logical database (e.g., production and staging), then you can
configure and switch between these directly from <code>orderly</code>
commands. At <a href="https://www.vaccineimpact.org" class="external-link">VIMC</a> we have
several copies of our main database: one called <code>production</code>,
which is the canonical copy, and then several <code>staging</code>
copies that we use for experimentation.</p>
<p>To configure this situation, list common arguments within the
<code>args</code> block as before, then add logical databases as named
entries in an <code>instances</code> field:</p>
<pre><code>plugins:
  orderly.db:
    source:
      driver: RPostgres::Postgres
      args:
        port: 5432
        user: user
        dbname: mydb
      instances:
        production:
          host: production.example.org
          password: $PASSWORD_PRODUCTION
        staging:
          host: staging.example.org
          password: $PASSWORD_STAGING
      default_instance: $DEFAULT_INSTANCE</code></pre>
<p>Here - staging and production have different hostnames
(<code>production.example.org</code> and
<code>staging.example.org</code>) and different passwords (retrieved
using environment variables) and the default instance is set with
another environment variable (<code>$DEFAULT_INSTANCE</code>, which must
be one of <code>production</code> or <code>staging</code>). To switch
between databases, you can set that variable, or pass the
<code>instance</code> argument to
<code>orderly.db::orderly_db_data</code> and friends, as:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly.db</span><span class="fu">::</span><span class="fu">orderly_db_data</span><span class="op">(</span>as <span class="op">=</span> <span class="st">"cars"</span>, database <span class="op">=</span> <span class="st">"source"</span>, query <span class="op">=</span> <span class="va">query</span>,</span>
<span>                             instance <span class="op">=</span> <span class="st">"production"</span><span class="op">)</span></span></code></pre></div>
<p>or</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly.db</span><span class="fu">::</span><span class="fu">orderly_db_data</span><span class="op">(</span>as <span class="op">=</span> <span class="st">"cars"</span>, database <span class="op">=</span> <span class="st">"source"</span>, query <span class="op">=</span> <span class="va">query</span>,</span>
<span>                             instance <span class="op">=</span> <span class="st">"staging"</span><span class="op">)</span></span></code></pre></div>
<p>If you pass a value of <code>NULL</code> for <code>instance</code>,
then we fall back on the default instance (and if none is specified,
throw an error). You might like to make this a parameter to your report
to allow changing the instance dynamically when running.</p>
</div>
</div>
<div class="section level2">
<h2 id="migrating-from-orderly-v1">Migrating from orderly v1<a class="anchor" aria-label="anchor" href="#migrating-from-orderly-v1"></a>
</h2>
<p>Querying for data</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">cars</span><span class="kw">:</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">query</span><span class="kw">:</span><span class="at"> SELECT * FROM mtcars WHERE cyl = 4</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">database</span><span class="kw">:</span><span class="at"> source</span></span></code></pre></div>
<p>becomes</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly.db</span><span class="fu">::</span><span class="fu">orderly_db_data</span><span class="op">(</span>as <span class="op">=</span> <span class="st">"cars"</span>, database <span class="op">=</span> <span class="st">"source"</span>,</span>
<span>                             query <span class="op">=</span> <span class="st">"SELECT * FROM mtcars WHERE cyl = 4"</span><span class="op">)</span></span></code></pre></div>
<p>Establishing views</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">views</span><span class="kw">:</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">cars4</span><span class="kw">:</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">query</span><span class="kw">:</span><span class="at"> SELECT * FROM mtcars WHERE cyl = 4</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">database</span><span class="kw">:</span><span class="at"> source</span></span></code></pre></div>
<p>becomes</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly.db</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_db_view.html">orderly_db_view</a></span><span class="op">(</span>as <span class="op">=</span> <span class="st">"cars4"</span>, database <span class="op">=</span> <span class="st">"source"</span>,</span>
<span>                             query <span class="op">=</span> <span class="st">"SELECT * FROM mtcars WHERE cyl = 4"</span><span class="op">)</span></span></code></pre></div>
<p>Exporting connections</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">connection</span><span class="kw">:</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">con</span><span class="kw">:</span><span class="at"> source</span></span></code></pre></div>
<p>becomes</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">orderly.db</span><span class="fu">::</span><span class="fu"><a href="../reference/orderly_db_connection.html">orderly_db_connection</a></span><span class="op">(</span>as <span class="op">=</span> <span class="st">"con"</span>, database <span class="op">=</span> <span class="st">"source"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="other-differences-in-behaviour">Other differences in behaviour<a class="anchor" aria-label="anchor" href="#other-differences-in-behaviour"></a>
</h3>
<p>In <code>orderly</code> v1, we saved a copy of the captured data
within <code>orderly</code>’s <code>data/</code> directory with the idea
that this would help with future reproducibility, however in practice
this did not prove useful. We do store some basic metrics within the
packet metadata about the extraction (number of rows fetched, names of
the columns etc), which can be used to track what was extracted, or at
least monitor for changes between different versions.</p>
<p>The control over different database instances used to be a top-level
argument to <code>orderly_run</code>, but now that the database is no
longer a core part of orderly that is not possible. Instead, instance is
just something that is passed through to the
<code>orderly.db::orderly_db_*</code> calls, and can be derived from any
variable you fancy. You can then configure its behaviour from an orderly
parameter, or from environment variables, or via some other
mechanism.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Rich FitzJohn.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
